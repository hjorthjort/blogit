#!/bin/bash

#Global varibles
rootpath='~/my-site'
configpath='/usr/local/etc/blogit.cnf'

function init {
	printf "server=%s\nrootpath=%s" "" "" > $configpath 
}


function set-server {
	#cat $configpath | sed 's/\(server=\).*/\1 "$1"/' >"$configpath"
	printf "Server set to $1"
}

function publish {
	#Set the name of the new html file
	page="$1.html"

	#Generate markdown and push to server
	pandoc "$1" | ssh $server "cat > $rootpath/blog-posts/'$page'"

	#Put the name of the new file in the index over all posts.
	ssh $server "touch $rootpath/blog-posts/.post-index.txt && sed -i '1i $page' $rootpath/blog-posts/.post-index.txt"
}

if [ $1 = "publish" ]; then 
	publish "$2"
fi

if [ $1 = "set-server" ]; then
	set-server "$2"
fi

if [ $1 = "init" ]; then
	init
fi
